# ADR-002: 9フェーズAI駆動開発フローの採用

## 日付
2026-02-03

## ステータス
承認済み

## コンテキスト（背景・課題）

### 問題
- AI駆動開発で多くのチームが直面する問題：
  - どのフェーズで何をすべきか分からず手戻りが発生
  - AIに丸投げして設計が曖昧なままコード生成
  - 新規開発と改修で同じフローを使い、副作用が発生
  - レビューで「なぜこう作ったの？」が答えられない
  - 品質が安定せず、バグが頻発

### 技術的背景
- AIはハルシネーションを起こす可能性がある
- AIには工数感覚がない
- 文脈（コンテキスト）なしでは正しい判断ができない

### ビジネス的背景
- 開発スピードと品質の両立が求められている
- チーム全体で一貫した開発プロセスが必要
- 新メンバーでもすぐに参加できる仕組みが望ましい

## 決定（What We Will Do）

**9フェーズAI駆動開発フローを採用する。**

具体的には：

1. **0→1（新規開発）**: 全9フェーズを実行
2. **1→2（機能追加・改修）**: 副作用分析を重視
3. **基本原則の適用**:
   - 1チケット = 1目的
   - Small PR原則（200行未満推奨）
   - コミットは意味単位
   - 段階的リリース

## 9フェーズ

| Phase | 名称 | 主な担当者 | 目的 |
|-------|------|-----------|------|
| 1 | アイデア | ディレクター | ユーザー要求の明確化と可視化 |
| 2 | 調査 | ディレクター | 外部依存の制約確認、ハルシネーション防止 |
| 3 | 設計 | ディレクター | 全体設計の決定 |
| 4 | 設計レビュー | キャプテン | 設計の妥当性検証 |
| 5 | タスク分解 | キャプテン | 並列作業可能な粒度に分割 |
| 6 | 詳細設計 | キャプテン | 実装詳細の決定、AIへの道標作成 |
| 7 | 詳細設計レビュー | プレイヤー | ロジックの妥当性検証 |
| 8 | 実装 | プレイヤー | コードの実装とテスト |
| 9 | コードレビュー | プレイヤー | コードの品質保証 |

## 基本原則

### 1チケット = 1目的
- 仕様変更とリファクタは分ける（混ぜない）
- 機能追加は機能追加のみ
- リファクタはリファクタのみ
- バグ修正はバグ修正のみ

### Small PR原則
- 理想的：PRあたり200行未満
- 最大：PRあたり400行
- 研究によると、200行未満のPRを持つチームは40%多くのコードをデプロイできる
- レビューしやすく、マージしやすく、問題があれば戻しやすく

### コミットは意味単位
- 変更理由が追える粒度で積む
- AIも履歴で理解しやすくなる
- 部分的な切り戻しが可能

### 段階的リリース
- Feature Flagや設定切り替えで「マージ＝即事故」を避ける
- カナリアリリース、Blue-Greenデプロイ等を活用

## 0→1と1→2の違い

### 0→1（新規開発）
- 全9フェーズを実行
- タスク分解は少しだけ大きめ（ハルシネーション防止）

### 1→2（機能追加・改修）
- **変更地点の特定**が必須
- **副作用分析**が最重要
- **前回設計の参照**が必須
- 軽微な変更ならタスク分解をスキップ可能
- タスク分解は最小単位で

## 検討した代替案

### 選択肢A: 従来の開発プロセス
- **メリット**:
  - チームに馴染みがある
  - ドキュメントが豊富
- **デメリット**:
  - AIに最適化されていない
  - 手戻りが多い
  - ハルシネーション対策がない

### 選択肢B: アジャイル開発
- **メリット**:
  - 変化に柔軟
  - 顧客フィードバックを重視
- **デメリット**:
  - 設計が軽視されがち
  - AIへの指示が曖昧になりがち
  - 技術的負債が蓄積しやすい

### 選択肢C: 9フェーズAI駆動開発フロー（採用）
- **メリット**:
  - AIに最適化されている
  - 手戻りが最小限
  - 品質が担保される
  - チーム全体で一貫したプロセス
  - 新メンバーでも理解しやすい
- **デメリット**:
  - フェーズが多く感じるかもしれない
  - 学習コストがかかる

## 結果（Consequences）

### ポジティブな結果

- **品質の安定**: 各フェーズでチェックがあるため品質が安定
- **手戻りの削減**: 早期に問題を発見できるため手戻りが減少
- **AIの効果的活用**: AIへの指示が明確になるためハルシネーションが減少
- **チーム全体の統一**: 全員が同じプロセスを使うため認識齟齬が減少
- **知識の蓄積**: 各フェーズの成果物が知識として蓄積される

### ネガティブな結果

- **初期のオーバーヘッド**: フェーズを飛ばしたくなる誘惑がある
- **ドキュメント作成コスト**: 各フェーズでドキュメントを作成する必要がある
- **学習コスト**: 新メンバーが9フェーズを学ぶ必要がある

### 中立的な結果

- 各フェーズでドキュメントが作成される
- フェーズ間の引き継ぎが必要になる

## 各フェーズのドキュメント

各フェーズの詳細は以下のドキュメントを参照：

- `/docs/PHASE_01_IDEA.md` - アイデアフェーズ
- `/docs/PHASE_02_INVESTIGATION.md` - 調査フェーズ
- `/docs/PHASE_03_DESIGN.md` - 設計フェーズ
- `/docs/PHASE_04_DESIGN_REVIEW.md` - 設計レビューフェーズ
- `/docs/PHASE_05_TASK_BREAKDOWN.md` - タスク分解フェーズ
- `/docs/PHASE_06_DETAILED_DESIGN.md` - 詳細設計フェーズ
- `/docs/PHASE_07_DETAILED_DESIGN_REVIEW.md` - 詳細設計レビューフェーズ
- `/docs/PHASE_08_IMPLEMENTATION.md` - 実装フェーズ
- `/docs/PHASE_09_CODE_REVIEW.md` - コードレビューフェーズ

## PR説明テンプレート

```markdown
## 目的（Why）
なぜこの変更が必要か

## 変更点（What）
何を変更したか

## テスト内容
どうテストしたか

## 影響範囲
どこに影響があるか

## レビューガイド
レビュアーがどの順序でファイルを見るべきか

## ロールバック
問題が起きた時の戻し方
```

## 信頼度
高

このフローはAI駆動開発のベストプラクティスに基づいており、多くの問題を解決します。
ただし、チームの状況に応じてカスタマイズが必要な場合があります。
