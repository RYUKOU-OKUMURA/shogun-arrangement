# Phase 9: コードレビュー (Code Review)

## 目的

コードの品質を保証し、最適化を図る。

## なぜ必要か

### レビューしないと品質が安定しない

- AIは間違える
- ハルシネーションは必ず起こる
- 人間のチェックが不可欠

### 「なぜ」を追求しないと最適化できない

- 冗長なコード
- 非効率なアルゴリズム
- メンテナンス性の低下
- 技術的負債の蓄積

### 関数ごとにレビューしないと精度が落ちる

- 全体を一度に見る → 見落とし多発
- 的を絞る → 精度向上
- 的確な返答が多い

### 綺麗なコードには綺麗なロジックを保てる

- メンテ性はAIにも現れる
- 次の修正時にAIが理解しやすい
- 技術的負債を防ぐ

## 何をするか

### 1. 「なぜ」を追求

- なぜこのロジックにしたのか
- なぜこの関数に分けたのか
- なぜこの順序なのか
- 設計意図との整合性

### 2. 関数ごとにレビューし最適化を図る

- 的確な返答が多い
- ロジックごとに的を絞ると精度が良くなる
- 1関数ずつ丁寧に

### 3. 以下の観点でチェック

- **冗長なコードではないか**
- **早期returnか**（ネストを浅くする）
- **数行の関数ならまとめる必要なし**（過度な分割を避ける）
- **関数の位置は最適か**（読みやすい順序）
- **関数ネスト、ネストは浅く**（3段階まで推奨）
- **当たり前だがみんなそこまでやらない**
- メンテ性はAIにも現れる、綺麗なコードには綺麗なロジックを保てる

### 4. 設計、詳細設計もコンテキストに含める

- 目的と、少ないコンテキストで全体像をくっきりと
- 設計意図からズレていないか確認
- ADRとの整合性

### 5. ツッコミは入れるが修正は行わない

- 役割を分ける
- レビュアーは指摘のみ
- 実装者が修正
- フィードバックループを回す

### 6. 品質ゲートを通す

- lint / typecheck / test を通す
- CIでFailしたらマージ不可（例外を作らない）
- フォーマットは自動化する

## レビュープロセス

### レビュー速度を優先

- PRが提出されたら2時間以内にレビュー開始（理想）
- 最大でも1営業日以内に初回フィードバック
- レビュー待ち時間がボトルネックになりがち

### レビューの責任分担を明確化

- DRAFT状態：早期フィードバックを求める段階
- READY FOR REVIEW：正式レビュー依頼
- 専門性に応じたレビュアー割り当て

### 建設的なフィードバック

- 「これは間違っている」ではなく「この部分について質問があります」
- 可能な限り代替案やリソースを提示
- 優れたPRは積極的に認める（モチベーション向上）

## チェックリスト

### 完了基準

- [ ] 「なぜ」が説明できるか？
- [ ] 冗長なコードがないか？
- [ ] ネストが深くないか（3段階まで）？
- [ ] 設計意図からズレていないか？
- [ ] レビューと修正の役割を分けているか？
- [ ] lint / typecheck / test が通っているか？
- [ ] 2時間以内にレビュー開始できるか？

### 出力物

- コードレビューレポート
- 修正指示リスト
- マージ済みPR

## 次のフェーズへの移行条件

- チェックリストの全項目が完了している
- 全てのレビューコメントが対応済み
- 品質ゲートを全てパスしている

## 参考リソース

- [Pull Request Best Practices](https://graphite.com/blog/pull-request-best-practices)
- コーディング規約
- 既存のコードレビュー事例
