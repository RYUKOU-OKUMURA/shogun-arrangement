# tmux-parallel-core

Claude Codeのためのサッカーチームスタイルのマルチエージェントオーケストレーションシステム。

## アーキテクチャ

```
ユーザー（ボス）
    │
    ▼ 指示
┌──────────────┐
│   ディレクター  │  ← 戦略的計画者（タスク分解、役割割り当て）
└──────┬───────┘
       │ YAML + send-keys
       ▼
┌──────────────┐
│   キャプテン   │  ← 調整者（指示の中継、進捗監視）
└──────┬───────┘
       │ YAML + send-keys
       ▼
┌───────┬───────┬───────┐
│プレイヤー1│プレイヤー2│プレイヤー3│  ← 実行者（実際の作業）
└───┬───┴───┬───┴───┬───┘
    │       │       │
    ▼       ▼       ▼
  タスク    タスク    タスク     ← サブエージェント（必要に応じてTaskツール経由）
  ツール    ツール    ツール
```

## クイックスタート

```bash
# 初期セットアップ
chmod +x init.sh start.sh
./init.sh

# 全エージェントの起動
./start.sh

# セッションへのアタッチ
tmux attach-session -t director   # 戦略的計画
tmux attach-session -t captain    # 調整
tmux attach-session -t players    # 実行
```

**📖 詳細なセットアップ手順については、[SETUP.md](SETUP.md)を参照してください**

## 通信フロー

1. **ユーザー → ディレクター**: ディレクターセッションでの直接入力
2. **ディレクター → キャプテン**: `queue/director_to_captain.yaml`に書き込み、その後send-keys
3. **キャプテン → プレイヤー**: `queue/captain_to_players/player{N}.yaml`に書き込み、その後send-keys
4. **プレイヤー → キャプテン**: タスク完了後にsend-keysで通知
5. **キャプテン → ディレクター**: `dashboard.md`を更新

### 重要：send-keysは2つの別々の呼び出しである必要があります！

```bash
# 間違い：結合（Enterが正しく解析されない）
tmux send-keys -t captain:0.0 'message' Enter

# 正しい：別々の呼び出し
tmux send-keys -t captain:0.0 'message'
tmux send-keys -t captain:0.0 Enter
```

## ディレクトリ構造

```
tmux-parallel-core/
├── start.sh                           # メイン起動スクリプト
├── init.sh                            # 初期セットアップ
├── SETUP.md                           # セットアップガイド
├── dashboard.md                       # 進捗ダッシュボード
├── project/                           # 共有プロジェクトファイル
│
├── docs/                              # 包括的なドキュメント
│   ├── AI_WORKFLOW.md                 # TDDワークフローガイド
│   ├── PROMPTING_GUIDE.md             # プロンプトデザインガイド
│   ├── QUALITY_GATES.md               # 品質基準
│   └── IMPLEMENTATION_ROADMAP.md      # 開発計画
│
├── director/
│   └── agents.md                      # ディレクターの指示
│
├── captain/
│   └── agents.md                      # キャプテンの指示
│
├── player1/
│   ├── agents.md                      # プレイヤー1の指示
│   ├── project -> ../project          # 共有プロジェクトへのシンボリックリンク
│   └── specs/                         # 設計ドキュメント
│
├── player2/
│   └── ...
│
├── player3/
│   └── ...
│
└── queue/
    ├── director_to_captain.yaml       # ディレクター → キャプテンへのコマンド
    └── captain_to_players/
        ├── player1.yaml               # キャプテン → プレイヤー1へのタスク
        ├── player2.yaml               # キャプテン → プレイヤー2へのタスク
        └── player3.yaml               # キャプテン → プレイヤー3へのタスク
```

## カスタマイズ

### プレイヤー数の変更

```bash
./start.sh -n 5   # 3の代わりに5人のプレイヤーを使用
```

### セットアップのみ（Claude Codeなし）

```bash
./start.sh -s     # セッションを作成、Claudeを手動で起動
```

### 指示の変更

各役割のディレクトリ内の`agents.md`ファイルを編集して、エージェントの動作をカスタマイズします。

## セッション参照

| 役割 | セッション | ペイン |
|------|-----------|-------|
| ディレクター | director | 0 |
| キャプテン | captain | 0 |
| プレイヤー1 | players | 0 |
| プレイヤー2 | players | 1 |
| プレイヤー3 | players | 2 |

## 重要な概念

### イベント駆動（ポーリングなし）

- 応答を待つためにループを使用しない
- 常にYAMLファイル + send-keys通知を使用する
- これによりAPIクレジットを節約

### 階層構造

- **ディレクター**: ユーザーのコマンドを受け取り、タスクを分解し、役割を割り当てる
- **キャプテン**: プレイヤーに指示を中継し、進捗を監視する
- **プレイヤー**: タスクを実行し、Taskツール経由でサブエージェントを生成できる

### サブエージェント（Taskツール）

プレイヤーはClaude CodeのTaskツールを使用して、以下のためにサブエージェントを生成できます：
- 複雑なサブタスク
- 並列独立作業
- コードレビュー
- テスト実行

### 競合状態の防止

- 各プレイヤーは専用のタスクファイルを持つ
- 2つのプレイヤーが同じファイルに書き込むことはない

## ドキュメント

AI駆動開発のための包括的なガイド：

- **[セットアップガイド](SETUP.md)** - 完全なインストールとセットアップ手順
  - 前提条件とインストール
  - システムの起動と停止
  - 設定とカスタマイズ
  - トラブルシューティング
  - 最初のタスクの例

- **[AIワークフロー](docs/AI_WORKFLOW.md)** - 完全なAI駆動開発ワークフロー
  - TDDプロセス（RED-GREEN-REFACTOR）
  - 小規模PRの原則（<200行）
  - 品質検証手順
  - 通信プロトコル
  - ベストプラクティスとアンチパターン

- **[プロンプティングガイド](docs/PROMPTING_GUIDE.md)** - 効果的なプロンプトデザイン
  - 豊富なコンテキストの提供方法
  - 成功基準の指定
  - 例駆動のプロンプティング
  - 一般的な落とし穴と修正
  - 役割別プロンプトテンプレート

- **[品質ゲート](docs/QUALITY_GATES.md)** - コード品質基準
  - 必須の品質チェック（カバレッジ、リント、型）
  - コード品質基準（不変性、エラー処理）
  - テスト品質要件（AAAパターン、不安定なテストなし）
  - モニタリングとメトリクス
  - しきい値定義（Green/Yellow/Red）

- **[実装ロードマップ](docs/IMPLEMENTATION_ROADMAP.md)** - 今後の開発計画
  - フェーズごとの実装戦略
  - コア機能の自動化
  - テストインフラストラクチャ
  - CI/CD統合
  - 高度な機能（学習、自己修復）
  - 成功指標とタイムライン
